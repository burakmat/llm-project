<!-- myapp/templates/home.html -->
<html>
<head>
    <title>LLM Project</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>LLM Project</h1>
    <form id="chat-form">
        <textarea id="user-input" placeholder="Type your message..."></textarea>
        <button type="submit">Send</button>
    </form>
    <div id="chat-output"></div>

    <script>
$('#chat-form').on('submit', function(e){
    e.preventDefault();
    var userInput = $('#user-input').val();

    // Append the user's message
    $('#chat-output').append('<p>You: ' + userInput + '</p>');

    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/chat_with_openai/', true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
    xhr.onprogress = function () {
        var response = xhr.responseText;
        var lastLine = response.substring(response.lastIndexOf('\n')+1);
        if (lastLine) {
            try {
                var json = JSON.parse(lastLine);
                $('#chat-output').append('<p>AI: ' + json.response + '</p>');
            } catch(e) {
                // Handle parsing error here
            }
        }
    };
    xhr.send('message=' + encodeURIComponent(userInput));

    // Clear the input field
    $('#user-input').val('');
});
    </script>
</body>
</html>
